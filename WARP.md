# WARP.md

This file provides guidance to WARP (warp.dev) when working with code in this repository.

## Project overview

This is a frontend-only Vite + React + TypeScript app generated by Lovable. It implements **PocketKash**, a personal finance coach for (primarily Indian) students and young earners, with:

- A marketing/landing experience
- A multi-step onboarding flow that captures user profile, income, habits, and limits
- A dashboard and time-based views (daily/weekly/monthly) over local transaction data
- An insights page that summarizes behaviour and emotion-tagged spending
- A floating AI-style assistant (`AIChatbot`) that answers questions based on local state

There is **no backend**; all data is client-side via React context and browser storage.

The source root is `src/`, with `@` aliased to `src` in both Vite and TypeScript.

## Tooling & common commands

Node.js + npm are required (see `README.md`). From the repo root:

- **Install dependencies**
  - `npm install`
- **Start dev server (Vite, port 8080)**
  - `npm run dev`
- **Production build**
  - `npm run build`
- **Development build (with `--mode development`)**
  - `npm run build:dev`
- **Preview the built app**
  - `npm run preview`
- **Lint the codebase (ESLint)**
  - `npm run lint`

### Tests

There are **no test scripts configured** in `package.json` and no obvious test runner setup. If you need tests, you will first need to add a test framework (e.g. Vitest) and corresponding `npm test`/`npm run test:unit` scripts before documenting how to run them.

## High-level architecture

### Entry point, providers, and routing

- `src/main.tsx` mounts the React app and imports global styles from `src/index.css`.
- `src/App.tsx` defines the application shell and wraps the tree with providers:
  - `QueryClientProvider` from `@tanstack/react-query` (currently available but lightly used; good place to hang future server calls).
  - `TooltipProvider` from the UI layer.
  - `UserProvider` (`src/contexts/UserContext.tsx`) and `FinanceProvider` (`src/contexts/FinanceContext.tsx`) for core app state.
  - `BrowserRouter` + `Routes` from `react-router-dom` for client-side routing.
- Primary routes (all defined in `App.tsx`):
  - `/` → `Landing`
  - `/auth` → `Auth` (auth stub/demo)
  - `/onboarding` → `Onboarding` (multi-step onboarding flow)
  - `/dashboard`, `/daily`, `/weekly`, `/monthly`, `/insights`, `/profile` → wrapped in `OnboardingGuard` and each rendered alongside `AIChatbot`.
  - `*` → `NotFound` fallback.
- `OnboardingGuard` (`src/components/guards/OnboardingGuard.tsx`) reads `isOnboarded` from `UserContext` and redirects unauthenticated/onboarding-incomplete users to `/onboarding`.

### Global state & data model

#### User state (`UserContext`)

- File: `src/contexts/UserContext.tsx`.
- Stores a `UserSettings` object with:
  - Demographics and role (`studying` / `working` / `both`).
  - Income configuration (allowance, salary, side income, `hasIncome`).
  - Behavioural info (`spendingFrequency`, `plansBeforeSpending`, `topSpendingCategory`).
  - Budget limits (`dailyLimit`, `weeklyLimit`, `monthlyLimit`).
  - `routineExpenses` list (id, name, amount, category).
- Persistence:
  - Uses `localStorage` under the key `pocketkash_user`.
  - On mount, it hydrates from localStorage and falls back to `defaultSettings` if parsing fails.
  - Subsequent updates are written back to localStorage whenever `user` changes.
- API exposed via context:
  - `completeOnboarding(data: OnboardingData)` — sets up the full `UserSettings` from onboarding input and flips `isOnboarded`.
  - `updateSettings(partial)` — shallow merge for later profile edits.
  - `logout()` — clears localStorage and resets `user`.
  - `getTotalIncome()` — derived numeric helper.
  - `isOnboarded` — boolean derived from `user?.isOnboarded`.
- Types live in `src/types/user.ts` (`UserRole`, `RoutineExpense`, `UserProfile`, `OnboardingData`).

#### Finance state (`FinanceContext`)

- File: `src/contexts/FinanceContext.tsx`.
- Holds an in-memory list of `Transaction` objects with:
  - `type` (`income` | `expense`)
  - `amount`
  - optional `category`, `source`, `emotionTag`
  - `date: Date` (note: real usage often serializes/deserializes dates if persisted anywhere)
  - `description`
- Begins with a hard-coded `sampleTransactions` array for demo purposes.
- Exposes:
  - `transactions` — current array state.
  - `addTransaction(transactionWithoutId)` — appends with a generated id.
  - `deleteTransaction(id)` — removes a transaction.
  - `getSummary()` — computes `FinanceSummary` (totals, category breakdown, behaviour type) from current `transactions`.
  - `getInsights()` — returns a list of coarse-grained `Insight` objects (behaviour classification, leaks, saving tips, stress alerts).
- Domain types live in `src/types/finance.ts` (`Transaction`, `FinanceSummary`, `Insight`, `ExpenseCategory`, `EmotionTag`, `IncomeSource`, `BehaviourType`).

### Layout, navigation, and pages

#### Layout shell

- `src/components/layout/AppLayout.tsx` is the main **app chrome** used by all post-onboarding pages:
  - Uses shadcn-like `Sidebar` primitives from `src/components/ui/sidebar.tsx` for a permanent desktop sidebar and a bottom navigation on mobile.
  - `navItems` define the canonical navigation: Dashboard, Daily, Weekly, Monthly, Insights, Profile.
  - Accepts `children` for page content and optional `onAddExpense` callback to show an “Add Expense” button in the sidebar/footer.
  - Handles responsive header, sidebar trigger (`SidebarTrigger`), and mobile bottom tab bar using `react-router-dom` links and `NavLink` for active state.

#### Pages

All pages live under `src/pages/` and are wired in `App.tsx`:

- `Landing.tsx` — public marketing screen composed from `components/landing/*` and a `SplashScreen` that only runs once per session (tracked via `sessionStorage`).
- `Onboarding.tsx` — thin wrapper that renders `OnboardingFlow`.
- `Dashboard.tsx` — primary home after onboarding:
  - Uses `AppLayout` with `onAddExpense`.
  - Derives today’s expense slice of `transactions` and computes `spentToday`, `dailyLimit`, and `routineExpensesRemaining` based on current time.
  - Renders `DailyOverview`, `SpendingSuggestion`, `SmartInsight`, and `TodaysExpensesList` components.
  - Uses `AddTransactionModal` and `useToast` for adding and deleting transactions.
- `Daily.tsx`, `Weekly.tsx`, `Monthly.tsx` — time-filtered transaction/budget views (Daily is the richest; other periods follow similar patterns).
- `Insights.tsx` — summary of behaviour and emotion-tagged spending:
  - Calls `getSummary()` and `getInsights()` from `FinanceContext`.
  - Computes additional derived metrics such as emotion-based spend totals and top category.
  - Presents them with rich cards and icons.
- `Profile.tsx` — user settings & profile (update of `UserContext`-backed data).
- `Auth.tsx`, `NotFound.tsx` — ancillary pages.

### AI-style assistant

- `src/components/chat/AIChatbot.tsx` renders a floating chat button and popover window that is included on key routes via `App.tsx`.
- It is **not** calling any external AI service; instead it:
  - Reads `transactions`, `getSummary()` from `FinanceContext` and `user` from `UserContext`.
  - Contains a `generateResponse(question: string)` function that pattern-matches on user queries (string includes checks) and produces pre-baked, but data-driven, answers.
  - Supports queries like "How much have I spent today?", "Why do I overspend?", "Where does my money go?", "What is my limit?", "What is my behaviour type?", and emotion-based prompts.
- State is local to the component (message history, input, typing state) and is reset on unmount.

### AI-powered insights (Bytez / Gemma)

- `src/hooks/use-ai-insights.ts` provides `useAIInsights(data)` hook for generating personalized financial advice.
- Uses **Bytez SDK** (`bytez.js`) with the `google/gemma-3-1b-it` model for fast inference.
- The hook:
  - Accepts `{ transactions, summary, userName }` and builds a compact prompt summarizing income, expenses, category breakdown, emotion-tagged spending, and flagged (impulse/stress) transactions.
  - Implements **caching via hash comparison** — only re-fetches when data changes significantly.
  - Provides a `refetch()` function for manual refresh.
  - Falls back to a local `generateFallbackInsight()` if the API is unavailable.
- Integrated in `src/pages/Insights.tsx` as an "AI Financial Coach" card that displays personalized tips.
- A separate "Flagged Spending" card highlights impulse and stress-tagged transactions.

### UI system & styling

- Tailwind is configured in `tailwind.config.ts` with content paths pointing at `./src/**/*.{ts,tsx}` (plus legacy `pages`, `components`, `app` globs).
- Design tokens and theme live in `src/index.css` under `@layer base`:
  - All semantic colors (`--background`, `--primary`, `--accent`, `--sidebar-*`, `--chart-*`, etc.) are HSL values defined for light and dark modes.
  - Font families (`--font-sans`, `--font-serif`, `--font-mono`) map to Google Fonts imports at the top of the file.
  - Multiple shadow and spacing variables are defined and then applied across components.
- Low-level UI primitives are in `src/components/ui/` (mostly shadcn-derived):
  - Components such as `button`, `card`, `dialog`, `toast`, `sidebar`, `form`, `input`, `select`, `tabs`, etc.
  - `button.tsx` is representative: it uses `class-variance-authority` with the `cn` helper from `src/lib/utils.ts` to define variants and sizes.
- Shared utilities & hooks:
  - `src/lib/utils.ts` — `cn` for class merging, `formatINR` for consistent INR currency formatting.
  - `src/hooks/use-toast.ts` — global toast store and hook used by pages and modals for user feedback.

### Domain-specific components

- `src/components/dashboard/*` contains most of the domain-specific widgets for the finance dashboard:
  - Cards for daily overview, smart insights, suggestions, spending charts, lists, modal for adding transactions, and smart alerts.
  - These all depend heavily on `FinanceContext` and `UserContext`-derived props rather than managing their own data fetching.
- `src/components/onboarding/OnboardingFlow.tsx` encapsulates the entire onboarding wizard:
  - Multi-step (`TOTAL_STEPS = 5`) card UI using `framer-motion` for transitions.
  - Collects basic info, income, behaviour, limits, and routine expenses into an `OnboardingData` object.
  - On completion, it calls `completeOnboarding` on `UserContext`, shows a toast, and navigates to `/dashboard`.

## Working within this codebase as Warp

When editing or extending this project:

- **Routing & pages**
  - Add or modify routes only in `src/App.tsx` and create corresponding components under `src/pages/`.
  - Keep app-level chrome (sidebar, header, bottom nav) inside `AppLayout` so pages remain focused on content/data.

- **State & business logic**
  - For cross-cutting finance or user logic, prefer adding to `FinanceContext` / `UserContext` (and their type files in `src/types/`) instead of duplicating calculations in multiple components.
  - Respect that `UserContext` is persisted in `localStorage`; any structural changes to `UserSettings` should handle missing/legacy fields gracefully.

- **Styling & UI**
  - Reuse existing primitives in `src/components/ui/` and the `cn` helper; do not hand-roll Tailwind class strings that duplicate existing variant logic unless necessary.
  - Keep new design tokens or palette changes centralized in `src/index.css` and `tailwind.config.ts`.

- **Data & behaviour-driven features**
  - The AI-style features (Insights page and `AIChatbot`) are all derived from the same `FinanceContext` summary and emotion tagging. When introducing new insight types or rules, implement them centrally in `FinanceContext.getSummary`/`getInsights` and then surface them in both the Insights page and chatbot where appropriate.
